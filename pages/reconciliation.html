<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Reconciliation</title>
    <!--css-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="/demo_cms_web/CSS/style.css"/> <!-- Đường dẫn đến style.css -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="">
</head>
<div class="bg-gray-100 font-sans">
    <div class="flex">
        <!-- Sidebar -->
        <div class="w-1/6 text-white min-h-screen p-4 sidebar">
            <div class="text-center mb-8">
                <img alt="Petal Pay Logo" class="mx-auto mb-4" height="50" src="/demo_cms_web/CSS/images/logo.png" width="300"/>
            </div>
            <nav>
                <ul>
                    <li class="mb-4 sidebar-item p-2">
                        <a class="flex items-center" href="dashboard.html">
                            <i class="fas fa-tachometer-alt mr-2"></i>
                            Dashboard
                        </a>
                    </li>
                    <li class="mb-4 sidebar-item p-2" onclick="toggleSubmenu(this)">
                        <a class="flex items-center justify-between" href="#">
                            <span class="flex items-center">
                                <i class="fas fa-chart-line mr-2"></i>
                                Commission
                            </span>
                            <i class="fas fa-chevron-down"></i>
                        </a>
                        <ul class="submenu">
                            <li class="mb-4 submenu-item p-2" onclick="showContent('reconciliation')">
                                <a class="flex items-center" href="#">
                                    <i class="fas fa-sync-alt mr-2"></i>
                                    Reconciliation
                                </a>
                            </li>
                            <li class="mb-4 submenu-item p-2">
                                <a class="flex items-center" href="payment.html">
                                    <i class="fas fa-credit-card mr-2"></i>
                                    Payment
                                </a>
                            </li>
                        </ul>
                    </li>
                    <li class="mb-4 sidebar-item p-2">
                        <a class="flex items-center" href="influencer.html">
                            <i class="fas fa-user-friends mr-2"></i>
                            Influencer
                        </a>
                    </li>
                    <li class="mb-4 sidebar-item p-2">
                        <a class="flex items-center" href="product.html">
                            <i class="fas fa-box mr-2"></i>
                            Product
                        </a>
                    </li>
                    <li class="mb-4 sidebar-item p-2">
                        <a class="flex items-center" href="promotion.html">
                            <i class="fas fa-bullhorn mr-2"></i>
                            Promotion
                        </a>
                    </li>
                    <li class="mb-4 sidebar-item p-2">
                        <a class="flex items-center" href="system.html">
                            <i class="fas fa-cogs mr-2"></i>
                            System
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
        <!-- Main Content -->
        <div class="w-5/6 p-8 main-content bg-[#F5EDED]" id="reconciliation">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-3xl font-bold text-[#A37C6B]">Reconciliation</h2>
                <div class="flex items-center">
                    <img alt="User Avatar" class="rounded-full mr-2" height="40" src="https://storage.googleapis.com/a1aa/image/UOcGYnK8ITsCcPmZuC4lFSmnbn5mPsjOFi581rmF9Lw.jpg" width="40"/>
                    <i class="fas fa-bell text-xl"></i>
                </div>
            </div>
            <div class="grid grid-cols-4 gap-2 mb-4">
                <div class="bg-white p-4 rounded shadow flex items-center" style="border-radius: 8px;">
                    <i class="fas fa-bullhorn text-3xl text-[#A37C6B] mr-4"></i>
                    <div>
                        <h3 class="text-lg font-semibold text-[#A37C6B]">Total Campaigns</h3>
                        <p class="text-2xl font-bold">154</p>
                    </div>
                </div>
                <div class="bg-white p-4 rounded shadow flex items-center" style="border-radius: 8px;">
                    <i class="fas fa-shopping-cart text-3xl text-[#A37C6B] mr-4"></i>
                    <div>
                        <h3 class="text-lg font-semibold text-[#A37C6B]">Total Orders</h3>
                        <p class="text-2xl font-bold">2935</p>
                    </div>
                </div>
                <div class="bg-white p-4 rounded shadow flex items-center" style="border-radius: 8px;">
                    <i class="fas fa-dollar-sign text-3xl text-[#A37C6B] mr-4"></i>
                    <div>
                        <h3 class="text-lg font-semibold text-[#A37C6B]">Total Revenue</h3>
                        <p class="text-2xl font-bold">$350.4</p>
                    </div>
                </div>
                <div class="bg-white p-4 rounded shadow flex items-center" style="border-radius: 8px;">
                    <i class="fas fa-coins text-3xl text-[#A37C6B] mr-4"></i>
                    <div>
                        <h3 class="text-lg font-semibold text-[#A37C6B]">Total Commission</h3>
                        <p class="text-2xl font-bold">$642.39</p>
                    </div>
                </div>
            </div>
            <div class="bg-white p-4 rounded shadow" style="border-radius: 8px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);">
                <h3 class="text-xl font-semibold mb-2 text-[#A37C6B]">List of orders</h3>
                <div class="mb-4">
                    <div class="flex items-center justify-start mb-2 flex-wrap">
                        <div class="flex flex-col mr-2 w-full md:w-auto">
                            <label class="text-[#A37C6B] mb-1">Search</label>
                            <input class="border rounded p-2" placeholder="Search" type="text" style="border-radius: 8px; width: 360px;"/>
                        </div>
                        <div class="flex flex-col mr-2 w-full md:w-auto">
                            <label class="text-[#A37C6B] mb-1">Order Status</label>
                            <select class="border rounded p-2" style="border-radius: 8px; width: 170px;">
                                <option>Order Status</option>
                            </select>
                            <span class="absolute right-2 top-2 pointer-events-none" style="right: 50px;"> <!-- Căn chỉnh khoảng cách -->
                                <i class="fas fa-chevron-down"></i>
                            </span>
                        </div>
                        <div class="flex flex-col mr-2 w-full md:w-auto">
                            <label class="text-[#A37C6B] mb-1">Payment method</label>
                            <select class="border rounded p-2" style="border-radius: 8px; width: 170px;">
                                <option>Payment method</option>
                            </select>
                        </div>
                        <div class="flex flex-col mr-2 w-full md:w-auto">
                            <label class="text-[#A37C6B] mb-1">Time Range</label>
                            <div class="flex space-x-2">
                                <input class="border rounded p-2" type="date" id="startDate" style="border-radius: 8px;"/>
                                <input class="border rounded p-2" type="date" id="endDate" style="border-radius: 8px;"/>
                            </div>
                        </div>
                        <div class="flex flex-col mr-2 w-full md:w-auto "> <!-- Thay đổi để căn chỉnh với các filter -->
                            <button class="bg-[#F5EDED] text-[#A37C6B] p-2 rounded flex items-center" style="border-radius: 8px; width: 100px; height: 36px; margin-bottom: 5px;" onclick="openDrawer()">
                                <i class="fas fa-file-import mr-2"></i> Import
                            </button>
                            <button class="bg-[#F5EDED] text-[#A37C6B] p-2 rounded flex items-center" style="border-radius: 8px; width: 100px; height: 36px;">
                                <i class="fas fa-file-export mr-2"></i> Export
                            </button>
                        </div>
                    </div>
                </div>
                <div class="table-container" style="max-height: 400px; overflow-y: auto;">
                    <table class="w-full text-left">
                        <thead>
                            <tr class="bg-[#F5EDED]">
                                <th class="border-b p-2 text-[#A37C6B]">Sub orderid</th>
                                <th class="border-b p-2 text-[#A37C6B]">Creator username</th>
                                <th class="border-b p-2 text-[#A37C6B]">Order ID</th>
                                <th class="border-b p-2 text-[#A37C6B]" style="width: 500px;">Product Name</th>
                                <th class="border-b p-2 text-[#A37C6B]">SKU</th>
                                <th class="border-b p-2 text-[#A37C6B]">Product ID</th>
                                <th class="border-b p-2 text-[#A37C6B]">Price</th>
                                <th class="border-b p-2 text-[#A37C6B]">Quantity</th>
                                <th class="border-b p-2 text-[#A37C6B]">Shop Name</th>
                                <th class="border-b p-2 text-[#A37C6B]">Shop Code</th>
                                <th class="border-b p-2 text-[#A37C6B]">Order Status</th>
                                <th class="border-b p-2 text-[#A37C6B]">Content Type</th>
                                <th class="border-b p-2 text-[#A37C6B]">Content ID</th>
                                <th class="border-b p-2 text-[#A37C6B]">Affiliate Partner Commission Rate (%)</th>
                                <th class="border-b p-2 text-[#A37C6B]">Creator Commission Rate (%)</th>
                                <th class="border-b p-2 text-[#A37C6B]">Est.commission base ($)</th>
                                <th class="border-b p-2 text-[#A37C6B]">Est Affiliate Partner Commission ($)</th>
                                <th class="border-b p-2 text-[#A37C6B]">Est. Creator commission ($)</th>
                                <th class="border-b p-2 text-[#A37C6B]">Actual commision base ($)</th>
                                <th class="border-b p-2 text-[#A37C6B]">Actual affiliate partner commission</th>
                                <th class="border-b p-2 text-[#A37C6B]">Actual creator commission</th>
                                <th class="border-b p-2 text-[#A37C6B]">Quantity returned</th>
                                <th class="border-b p-2 text-[#A37C6B]">Quantity refunded</th>
                                <th class="border-b p-2 text-[#A37C6B]">Time created</th>
                                <th class="border-b p-2 text-[#A37C6B]">Time order deliveried</th>
                                <th class="border-b p-2 text-[#A37C6B]">Time Comission Paid</th>
                                <th class="border-b p-2 text-[#A37C6B]">Payment ID</th>
                                <th class="border-b p-2 text-[#A37C6B]">Payment method</th>
                                <th class="border-b p-2 text-[#A37C6B]">Payment Account</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Dữ liệu sẽ được thêm vào đây thông qua JavaScript -->
                        </tbody>
                    </table>
                </div>
                <div class="flex justify-end items-center mt-4">
                    <nav aria-label="Page navigation example">
                        <ul class="pagination">
                            <li class="page-item">
                                <a class="page-link" href="#" aria-label="Previous">
                                    <span aria-hidden="true">&laquo;</span>
                                </a>
                            </li>
                            <li class="page-item"><a class="page-link" href="#">1</a></li>
                            <li class="page-item"><a class="page-link" href="#">2</a></li>
                            <li class="page-item"><a class="page-link" href="#">3</a></li>
                            <li class="page-item">
                                <a class="page-link" href="#" aria-label="Next">
                                    <span aria-hidden="true">&raquo;</span>
                                </a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Drawer -->
<div id="overlay" class="overlay" style="display: none;"></div>
<!-- Drawer -->
<!-- Drawer -->
<div id="drawer" class="drawer" style="display: none;">
    <div class="max-w-4xl mx-auto p-4">
        <div class="flex justify-between items-center mb-4">
            <div class="flex items-center" onclick="closeDrawer()">
                <i class="fas fa-arrow-left text-gray-600"></i>
                <span class="ml-2 text-gray-600">Đóng</span>
            </div>
            <button class="bg-[#A37C6B] text-white px-4 py-2 rounded" onclick="confirmUpload()">Xác nhận</button>
        </div>
        <h1 class="text-xl font-semibold mb-4">Tải lên dữ liệu</h1>
        <p class="text-gray-600 mb-2">Vui lòng tải lên file Excel hoặc CSV theo mẫu.</p>
        <div class="border border-gray-300 rounded-lg p-6 flex items-center justify-center">
            <div class="text-center">
                <label for="file-upload" class="bg-gray-200 rounded-full p-4 inline-block mb-2 cursor-pointer">
                    <i class="fas fa-upload text-gray-600 text-2xl"></i>
                </label>
                <p class="text-gray-600 font-semibold">Nhấn tải lên file danh sách</p>
                <p class="text-gray-500">File dữ liệu (.xlsx, .xls hoặc .csv)</p>
                <input id="file-upload" type="file" accept=".xlsx, .xls, .csv" class="hidden" onchange="uploadFile()" />
                
                <!-- Phần hiển thị tên file -->
                <div id="file-name-display" class="mt-2 text-gray-600"></div>
            </div>
        </div>
    </div>
</div>
<div id="upload-success-banner" class="alert alert-success" style="display: none; margin-top: 10px;">
    Files have been successfully uploaded.
    <button onclick="this.parentElement.style.display='none'" style="float:right; border:none; background:none; cursor:pointer;">&times;</button>
</div>

<script>
    let currentPage = 1; // Variable to track the current page
    let selectedFile = null; // Global variable to store the selected file

    function toggleSubmenu(element) {
        element.classList.toggle('active');
    }

    function showContent(contentId) {
        document.querySelectorAll('.main-content').forEach(content => {
            content.classList.remove('active');
        });
        document.getElementById(contentId).classList.add('active');
    }

    function uploadFile() {
        const fileInput = document.getElementById('file-upload');
        selectedFile = fileInput.files[0];

        if (!selectedFile) {
            alert('Vui lòng chọn file để tải lên.');
            return;
        }

        // Display the file name and icon
        const fileNameDisplay = document.getElementById('file-name-display');
        fileNameDisplay.innerHTML = `
            <i class="fas fa-file-excel text-green-500"></i> 
            ${selectedFile.name}
        `;

        // Show success banner
        document.getElementById('upload-success-banner').style.display = 'block';
    }

    function confirmUpload() {
        if (!selectedFile) {
            alert('Vui lòng chọn file để tải lên.');
            return;
        }

        // Create a FormData object to send the file
        const formData = new FormData();
        formData.append('file', selectedFile); // Add the file to FormData

        // Send a POST request to the /upload endpoint
        fetch('/demo_cms_web/uploads', {
            method: 'POST',
            body: formData
        })
        .then(response => {
            if (response.ok) {
                alert('Tải lên thành công!'); // Show success message
                loadData(); // Refresh data in the table
                closeDrawer(); // Close the drawer after successful upload
            } else {
                alert('Tải lên thất bại!'); // Show failure message
            }
        })
        .catch(error => {
            console.error('Lỗi:', error); // Log the error to console
            alert('Đã xảy ra lỗi khi tải lên.'); // Show error message
        });
    }

    function loadData() {
        fetch('/demo_cms_web/Data')
        .then(response => {
            if (!response.ok) {
                return response.text().then(text => { throw new Error(text); });
            }
            return response.json();
        })
        .then(result => {
            console.log(result); // Check the data
            const tableBody = document.querySelector('tbody');
            tableBody.innerHTML = ''; // Clear existing data
    
            result.data.forEach(item => {
                const row = `<tr>
                    <td class="border-b p-2">${item['Sub orderid'] || ''}</td>
                    <td class="border-b p-2">${item['Creator username'] || ''}</td>
                    <td class="border-b p-2">${item['Order ID'] || ''}</td>
                    <td class="border-b p-2">${item['Product Name'] || ''}</td>
                    <td class="border-b p-2">${item['SKU'] || ''}</td>
                    <td class="border-b p-2">${item['Product ID'] || ''}</td>
                    <td class="border-b p-2">${item['Price'] || ''}</td>
                    <td class="border-b p-2">${item['Quantity'] || ''}</td>
                    <td class="border-b p-2">${item['Shop Name'] || ''}</td>
                    <td class="border-b p-2">${item['Shop Code'] || ''}</td>
                    <td class="border-b p-2">${item['Order Status'] || ''}</td>
                    <td class="border-b p-2">${item['Content Type'] || ''}</td>
                    <td class="border-b p-2">${item['Content ID'] || ''}</td>
                    <td class="border-b p-2">${item['Affiliate Partner Commission Rate (%)'] || ''}</td>
                    <td class="border-b p-2">${item['Creator Commission Rate (%)'] || ''}</td>
                    <td class="border-b p-2">${item['Est.commission base ($)'] || ''}</td>
                    <td class="border-b p-2">${item['Est Affiliate Partner Commission ($)'] || ''}</td>
                    <td class="border-b p-2">${item['Est. Creator commission ($)'] || ''}</td>
                    <td class="border-b p-2">${item['Actual commision base ($)'] || ''}</td>
                    <td class="border-b p-2">${item['Actual affiliate partner commission'] || ''}</td>
                    <td class="border-b p-2">${item['Actual creator commission'] || ''}</td>
                    <td class="border-b p-2">${item['Quantity returned'] || ''}</td>
                    <td class="border-b p-2">${item['Quantity refunded'] || ''}</td>
                    <td class="border-b p-2">${item['Time created'] || ''}</td>
                    <td class="border-b p-2">${item['Time order deliveried'] || ''}</td>
                    <td class="border-b p-2">${item['Time Comission Paid'] || ''}</td>
                    <td class="border-b p-2">${item['Payment ID'] || ''}</td>
                    <td class="border-b p-2">${item['Payment method'] || ''}</td>
                    <td class="border-b p-2">${item['Payment Account'] || ''}</td>
                </tr>`;
                tableBody.insertAdjacentHTML('beforeend', row); // Add new row to the table
            });
    
            // Update pagination
            updatePagination(result.total_pages);
        })
        .catch(error => {
            console.error('Error fetching data:', error); // Log the error
            alert('Failed to load data: ' + error.message); // Show an alert with error message
        });
    }

    function updatePagination(totalPages) {
        const paginationContainer = document.querySelector('.pagination');
        paginationContainer.innerHTML = ''; // Clear old content
    
        const pageCount = 3; // Number of pages to show
        let startPage = Math.max(1, currentPage - Math.floor(pageCount / 2));
        let endPage = Math.min(totalPages, startPage + pageCount - 1);
    
        // Adjust startPage if endPage is at totalPages
        if (endPage === totalPages) {
            startPage = Math.max(1, totalPages - pageCount + 1);
        }
    
        // Create Previous button
        const prevButton = document.createElement('li');
        prevButton.className = 'page-item';
        prevButton.innerHTML = `<a class="page-link" href="#" aria-label="Previous" onclick="changePage(currentPage - 1)"><span aria-hidden="true">&laquo;</span></a>`;
        if (currentPage === 1) {
            prevButton.classList.add('disabled'); // Disable Previous button if on first page
        }
        paginationContainer.appendChild(prevButton);
    
        // Create page buttons
        for (let i = startPage; i <= endPage; i++) {
            const pageItem = document.createElement('li');
            pageItem.className = 'page-item';
            pageItem.innerHTML = `<a class="page-link" href="#" onclick="changePage(${i})">${i}</a>`;
            if (i === currentPage) {
                pageItem.classList.add('active'); // Highlight current page
            }
            paginationContainer.appendChild(pageItem);
        }
    
        // Create Next button
        const nextButton = document.createElement('li');
        nextButton.className = 'page-item';
        nextButton.innerHTML = `<a class="page-link" href="#" aria-label="Next" onclick="changePage(currentPage + 1)"><span aria-hidden="true">&raquo;</span></a>`;
        if (currentPage === totalPages) {
            nextButton.classList.add('disabled'); // Disable Next button if on last page
        }
        paginationContainer.appendChild(nextButton);
    }

    // Load data when the page is loaded
    window.onload = loadData;

    function openDrawer() {
        document.getElementById('overlay').style.display = 'block'; // Show overlay
        document.getElementById('drawer').style.display = 'block'; // Show drawer
        setTimeout(() => {
            document.getElementById('drawer').classList.add('open');
        }, 10);
    }

    function closeDrawer() {
        document.getElementById('drawer').classList.remove('open');
        setTimeout(() => {
            document.getElementById('drawer').style.display = 'none'; // Hide drawer
            document.getElementById('overlay').style.display = 'none'; // Hide overlay
        }, 300);
    }
</script>
</body>
</html>